const { parseFontAwesomeIcon } = require('./icon-parser');

function postNote(args, content) {
  if (args.length === 0) {
    args.push("default");
  }

  let icon = "";
  
  // Extract style classes from all args except potential icon classes
  let classes = [];
  const remainingArgs = [...args]; // Copy args array
  
  // Add first arg as main class
  if (remainingArgs.length > 0) {
    classes.push(remainingArgs[0]);
    remainingArgs.shift();
  }
  
  // Parse FontAwesome icon from remaining arguments
  const { icon: parsedIcon, remainingArgs: parsedArgs } = parseFontAwesomeIcon(remainingArgs, "note-icon");
  icon = parsedIcon;
  
  // Add any remaining args as additional classes
  classes = classes.concat(parsedArgs);
  
  // Add icon-padding class if icon exists
  if (icon) {
    classes.push("icon-padding");
  }

  return `
  <div class="note p-4 mb-4 rounded-small markdown-body ${classes.join(" ")}">
    ${icon}${hexo.render.renderSync({
      text: content,
      engine: "markdown",
    })}
  </div>`;
}

hexo.extend.tag.register("note", postNote, { ends: true });
hexo.extend.tag.register("notes", postNote, { ends: true });
hexo.extend.tag.register("subnote", postNote, { ends: true });